<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SGF - Sistema de Gestão de Frota (Aegea v12.1 Bug Fix)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-material-ui/material-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* CORES AEGEA */
            --primary: #003087; --accent: #00B0B9; --bg: #f3f6f9; --surface: #ffffff;
            --text-main: #1e293b; --text-sec: #64748b; --border: #e2e8f0;
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b; --info: #3b82f6; --manutencao: #64748b;
            --shadow-card: 0 4px 6px -1px rgba(0, 48, 135, 0.1);
            --shadow-hover: 0 20px 25px -5px rgba(0, 48, 135, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); padding: 20px; color: var(--text-main); padding-bottom: 100px; }
        .container { max-width: 1280px; margin: 0 auto; display: block; animation: fadeIn 0.5s ease-out; }
        
        /* HEADER & NAV */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 15px 30px; background: var(--surface); border-radius: 20px; box-shadow: var(--shadow-card); border-bottom: 4px solid var(--accent); }
        .header-logo-area img { height: 55px; object-fit: contain; }
        .tabs { display: flex; gap: 12px; margin-bottom: 30px; flex-wrap: wrap; }
        .tab-btn { padding: 14px 24px; background: var(--surface); border: 1px solid transparent; border-radius: 14px; font-weight: 600; color: var(--text-sec); cursor: pointer; transition: 0.2s; flex-grow: 1; font-size: 0.95rem; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .tab-btn:hover { background: #fff; color: var(--primary); transform: translateY(-2px); box-shadow: var(--shadow-hover); }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 8px 20px -4px rgba(0, 48, 135, 0.4); }
        .bottom-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-top: 1px solid var(--border); z-index: 999; justify-content: space-around; padding: 12px 0; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #94a3b8; font-size: 0.7rem; background: none; border: none; cursor: pointer; width: 100%; transition: 0.2s; }
        .nav-item.active { color: var(--primary); font-weight: 700; }
        @media (max-width: 768px) { .tabs { display: none; } .bottom-nav { display: flex; } body { padding: 15px; padding-bottom: 110px; } header { padding: 20px; flex-direction: column; gap: 15px; text-align: center; } }

        /* HERO CARDS */
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .hero-card { background: var(--surface); padding: 25px; border-radius: 20px; position: relative; overflow: hidden; box-shadow: var(--shadow-card); transition: 0.3s; display: flex; flex-direction: column; justify-content: space-between; height: 140px; }
        .hero-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); }
        .hero-icon { position: absolute; right: -10px; top: -10px; font-size: 6rem; opacity: 0.08; }
        .hero-label { font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; z-index: 1; }
        .hero-value { font-size: 2.8rem; font-weight: 800; line-height: 1; z-index: 1; letter-spacing: -2px; }
        .hero-rua { color: var(--warning); } .hero-disp { color: var(--success); } .hero-manut { color: var(--manutencao); }

        /* CONTROL & TABLES */
        .control-panel { background: var(--surface); padding: 30px; border-radius: 20px; box-shadow: var(--shadow-card); margin-bottom: 30px; display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 40px; border: 1px solid var(--border); }
        @media (max-width: 900px) { .control-panel { grid-template-columns: 1fr; gap: 25px; padding: 20px; } }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 0.75rem; color: var(--text-sec); text-transform: uppercase; }
        select, input, textarea { width: 100%; padding: 14px 18px; border: 2px solid var(--border); border-radius: 12px; font-size: 1rem; background-color: #f8fafc; transition: all 0.2s; }
        select:focus, input:focus, textarea:focus { outline: none; border-color: var(--accent); background: #fff; box-shadow: 0 0 0 4px rgba(0, 176, 185, 0.15); }
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        button.btn-action { padding: 18px; border: none; border-radius: 14px; font-weight: 800; cursor: pointer; color: white; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; justify-content: center; gap: 10px; transition: transform 0.1s; }
        button.btn-action:active { transform: scale(0.96); }
        .btn-saida { background: linear-gradient(135deg, #f59e0b, #d97706); } .btn-entrada { background: linear-gradient(135deg, #10b981, #059669); } .btn-manutencao { background: linear-gradient(135deg, #64748b, #475569); }
        .table-wrapper { background: var(--surface); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-card); margin-top: 20px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #f8fafc; color: var(--text-sec); text-align: left; padding: 18px 20px; font-size: 0.75rem; text-transform: uppercase; font-weight: 800; border-bottom: 2px solid var(--border); }
        td { padding: 16px 20px; border-bottom: 1px solid var(--border); color: var(--text-main); vertical-align: middle; font-weight: 500; }
        table tbody tr:hover { background-color: #f1f5f9; }
        .badge { padding: 6px 12px; border-radius: 30px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; display: inline-flex; align-items: center; gap: 5px; }
        .status-rua { background: #fef3c7; color: #b45309; } .status-outros { background: #e0f2fe; color: #0369a1; } .status-manut { background: #f1f5f9; color: #475569; }
        .badge-tempo { background: #e0f2f1; color: #00695c; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; border: 1px solid #b2dfdb; }

        /* === DASHBOARD V10 === */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-top: 25px; }
        .chart-card { background: white; padding: 25px; border-radius: 16px; border: 1px solid var(--border); box-shadow: var(--shadow-card); display: flex; flex-direction: column; }
        .chart-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .chart-title { font-size: 1.1rem; font-weight: 800; color: var(--primary); display: block; }
        .chart-legend-text { font-size: 0.8rem; color: var(--text-sec); font-weight: 500; margin-top: 4px; display: block; }
        
        /* Pico (Barras Verticais) */
        .peak-chart { display: flex; align-items: flex-end; justify-content: space-between; height: 150px; padding-top: 20px; gap: 4px; }
        .peak-col { flex: 1; background: var(--accent); border-radius: 4px 4px 0 0; position: relative; min-height: 4px; transition: height 0.5s; opacity: 0.7; }
        .peak-axis { display: flex; justify-content: space-between; font-size: 0.7rem; color: #94a3b8; margin-top: 8px; font-weight: bold; }

        /* Listas (Rankings e SLA) */
        .rank-list { display: flex; flex-direction: column; gap: 10px; max-height: 200px; overflow-y: auto; }
        .rank-item { display: flex; align-items: center; justify-content: space-between; padding: 8px; border-bottom: 1px dashed #f1f5f9; }
        .rank-info { font-weight: 700; color: var(--text-main); }
        .rank-val { color: var(--primary); font-weight: 800; background: #e0f7fa; padding: 2px 8px; border-radius: 4px; font-size: 0.85rem; }
        
        .sla-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: #fef2f2; border-left: 4px solid var(--danger); border-radius: 4px; margin-bottom: 8px; }
        .sla-text strong { display: block; color: #991b1b; font-size: 0.9rem; }
        .sla-text small { color: #b91c1c; font-size: 0.8rem; }

        /* Categoria (Barras Horizontais) */
        .cat-row { display: flex; align-items: center; margin-bottom: 12px; font-size: 0.9rem; }
        .cat-name { width: 100px; font-weight: 600; color: var(--text-sec); text-align: right; margin-right: 10px; }
        .cat-bar-bg { flex: 1; background: #f1f5f9; height: 10px; border-radius: 5px; overflow: hidden; }
        .cat-bar-fill { height: 100%; background: var(--primary); border-radius: 5px; }
        .cat-val { width: 30px; text-align: right; font-weight: 800; color: var(--primary); margin-left: 10px; }
        
        /* LOGIN */
        #login-screen { background: linear-gradient(135deg, #003087 0%, #001233 100%); position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-card { background: rgba(255,255,255,0.95); padding: 50px; border-radius: 30px; width: 420px; max-width: 90%; text-align: center; box-shadow: 0 25px 60px rgba(0,0,0,0.4); backdrop-filter: blur(10px); }
        .login-btn { width: 100%; padding: 18px; margin-top: 15px; border: none; border-radius: 14px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* UTILS */
        .hidden { display: none !important; }
        .admin-only { display: none !important; }
        body.admin-mode .admin-only { display: inline-block !important; }
        body.admin-mode .nav-item.admin-only { display: flex !important; }
        body.admin-mode tr.admin-only { display: table-row !important; }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.show { display: block; }
        .search-bar { position: relative; width: 300px; max-width: 100%; }
        .search-bar input { padding-left: 45px; border-radius: 30px; border-color: var(--border); }
        .search-bar i { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--accent); }
        @media (max-width: 600px) { table, thead, tbody, th, td, tr { display: block; } thead tr { position: absolute; top: -9999px; left: -9999px; } tr { margin-bottom: 15px; border-radius: 16px; padding: 15px; background: white; box-shadow: var(--shadow-card); border: 1px solid var(--border); } td { border: none; border-bottom: 1px dashed var(--border); position: relative; padding-left: 45%; text-align: right; display: flex; justify-content: space-between; align-items: center; } td:before { content: attr(data-label); font-weight: 800; color: var(--text-sec); font-size: 0.75rem; text-transform: uppercase; } td:last-child { border: none; justify-content: flex-end; padding-top: 15px; } }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <img src="logo.png" alt="Aegea" style="height: 70px; margin-bottom: 25px;" onerror="this.style.display='none'">
        <h1 style="color:var(--primary); font-size: 1.5rem; margin-bottom: 5px;">SGF AEGEA</h1>
        <p style="color: var(--text-sec); margin-bottom: 30px; font-size: 0.9rem;">Sistema de Gestão de Frota</p>
        <button class="login-btn" style="background: var(--accent); color: white; box-shadow: 0 8px 20px -5px rgba(0, 176, 185, 0.4);" onclick="login('motorista')"><i class="fa-solid fa-steering-wheel"></i> ACESSO MOTORISTA</button>
        <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
            <button class="login-btn" style="background: white; border: 2px solid var(--primary); color: var(--primary);" onclick="mostrarInputAdmin()"><i class="fa-solid fa-lock"></i> ÁREA ADMINISTRATIVA</button>
            <input type="password" id="admin-pass" style="margin-top: 15px; display: none;" placeholder="Senha do Admin" onkeyup="checkAdminPass(event)">
        </div>
    </div>
</div>

<input type="file" id="input-restore" class="hidden" accept=".json" onchange="processarRestauracao(this)">

<div class="container">
    <header>
        <div class="header-logo-area">
            <img src="logo.png" alt="Logo" onerror="this.style.display='none';">
            <div style="display: inline-block; vertical-align: middle; margin-left: 15px;">
                <h2 style="margin:0; font-size: 1.4rem;">SGF AEGEA</h2>
                <span class="badge" style="background:var(--accent); color:white; margin-top:5px;" id="user-badge">Visitante</span>
            </div>
        </div>
        <div style="text-align: right;">
            <h2 id="relogio" style="font-family: monospace; font-weight: 700; color: var(--primary); margin:0;">00:00</h2>
            <button onclick="logout()" style="margin-left: 15px; background: var(--danger); color: white; border:none; padding: 8px 12px; border-radius: 10px; cursor: pointer;"><i class="fa-solid fa-right-from-bracket"></i></button>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="mudarAba('monitoramento')"><i class="fa-solid fa-map-location-dot"></i> Monitoramento</button>
        <button class="tab-btn admin-only" onclick="mudarAba('dashboard')"><i class="fa-solid fa-chart-pie"></i> Dashboard Pro</button>
        <button class="tab-btn admin-only" onclick="mudarAba('manutencao')"><i class="fa-solid fa-wrench"></i> Manutenção</button>
        <button class="tab-btn admin-only" onclick="mudarAba('historico')"><i class="fa-solid fa-clock-rotate-left"></i> Histórico</button>
        <button class="tab-btn admin-only" onclick="mudarAba('gestao')"><i class="fa-solid fa-gear"></i> Gestão</button>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="mudarAba('monitoramento')"><i class="fa-solid fa-map-location-dot"></i><span>Monitor</span></button>
        <button class="nav-item admin-only" onclick="mudarAba('dashboard')"><i class="fa-solid fa-chart-pie"></i><span>Dash</span></button>
        <button class="nav-item admin-only" onclick="mudarAba('manutencao')"><i class="fa-solid fa-wrench"></i><span>Manut</span></button>
        <button class="nav-item admin-only" onclick="mudarAba('historico')"><i class="fa-solid fa-clock-rotate-left"></i><span>Hist</span></button>
        <button class="nav-item admin-only" onclick="mudarAba('gestao')"><i class="fa-solid fa-gear"></i><span>Gestão</span></button>
    </nav>

    <div id="aba-monitoramento" class="tab-content show">
        <div class="status-grid">
            <div class="hero-card hero-rua"><i class="fa-solid fa-road hero-icon"></i><span class="hero-label">Em Trânsito</span><span id="count-rua" class="hero-value">0</span></div>
            <div class="hero-card hero-disp"><i class="fa-solid fa-square-parking hero-icon"></i><span class="hero-label">Disponível</span><span id="count-garagem" class="hero-value">0</span></div>
            <div class="hero-card hero-manut"><i class="fa-solid fa-screwdriver-wrench hero-icon"></i><span class="hero-label">Manutenção</span><span id="count-manutencao" class="hero-value">0</span></div>
        </div>

        <div class="control-panel">
            <div>
                <div class="form-group"><label>1. Selecione o Veículo</label><select id="select-placa" onchange="preencherDados()"><option value="">-- Toque para selecionar --</option></select></div>
                <div style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 2;"><label>Modelo</label><input type="text" id="input-modelo" class="readonly-field" readonly></div>
                    <div class="form-group" style="flex: 1;"><label>KM Saída</label><input type="number" id="input-km-saida" placeholder="000"></div>
                </div>
                <div class="form-group"><label>Condutor / Destino</label><input type="text" id="input-condutor" placeholder="Nome do condutor"></div>
                <div class="form-group"><label>Justificativa</label><input type="text" id="input-justificativa" placeholder="Opcional..."></div>
            </div>
            <div style="display: flex; flex-direction: column; justify-content: center;">
                <div id="status-box" style="text-align: center; margin-bottom: 20px; padding: 30px; border-radius: 20px; background: #f8fafc; border: 2px dashed var(--border);"><span style="color: var(--text-sec); font-size: 0.8rem; text-transform: uppercase; font-weight: 800; letter-spacing: 1px;">Status Atual</span><br><strong id="status-texto" style="font-size: 1.4rem; color: var(--primary);">Aguardando...</strong></div>
                <div class="actions">
                    <button class="btn-action btn-saida" onclick="registrarSaida('RUA')"><i class="fa-solid fa-road"></i> SAÍDA</button>
                    <button class="btn-action btn-saida" style="background: linear-gradient(135deg, var(--info), #2563eb);" onclick="registrarSaida('OUTROS')"><i class="fa-solid fa-share"></i> OUTROS</button>
                    <button class="btn-action btn-entrada" onclick="registrarEntrada()"><i class="fa-solid fa-check"></i> BAIXAR</button>
                    <button class="btn-action btn-manutencao admin-only" onclick="enviarParaManutencao()"><i class="fa-solid fa-screwdriver-wrench"></i> MANUT.</button>
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
            <h3 style="color: var(--primary); font-weight: 800;">VEÍCULOS NA RUA</h3>
            <div class="search-bar"><i class="fa-solid fa-magnifying-glass"></i><input type="text" placeholder="Pesquisar..." onkeyup="filtrarTabela('tabela-transito', this.value)"></div>
        </div>

        <div class="table-wrapper">
            <table id="tabela-transito">
                <thead><tr><th>Placa</th><th>Condutor</th><th>KM</th><th>Status</th><th>Saída</th><th>Tempo</th><th>Ação</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="aba-dashboard" class="tab-content">
        <div class="dashboard-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <span class="chart-title">Horários de Pico</span>
                        <span class="chart-legend-text">Volume de saídas ao longo do dia (06h - 22h)</span>
                    </div>
                    <i class="fa-solid fa-clock" style="color: var(--accent); font-size: 1.2rem;"></i>
                </div>
                <div class="peak-chart" id="chart-peak"></div>
                <div class="peak-axis"><span>06h</span><span>12h</span><span>18h</span><span>22h</span></div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <span class="chart-title">Manutenção por Categoria</span>
                        <span class="chart-legend-text">Principais motivos de parada na oficina</span>
                    </div>
                    <i class="fa-solid fa-wrench" style="color: var(--manutencao); font-size: 1.2rem;"></i>
                </div>
                <div id="chart-manutencao-cat" style="min-height: 170px;"></div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <span class="chart-title">Ranking de Rodagem</span>
                        <span class="chart-legend-text">Top 5 Veículos com mais KM acumulados</span>
                    </div>
                    <i class="fa-solid fa-gauge-high" style="color: var(--success); font-size: 1.2rem;"></i>
                </div>
                <div class="rank-list" id="list-ranking-km"></div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <span class="chart-title">Alertas de SLA (Viagens > 10h)</span>
                        <span class="chart-legend-text">Últimas ocorrências de viagens longas</span>
                    </div>
                    <i class="fa-solid fa-triangle-exclamation" style="color: var(--danger); font-size: 1.2rem;"></i>
                </div>
                <div class="rank-list" id="list-sla-alerts">
                    <div style="text-align:center; color:#ccc; padding:20px;">Nenhum alerta recente</div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="aba-manutencao" class="tab-content">
        <div class="control-panel" style="grid-template-columns: 1fr; gap: 10px; padding: 20px; margin-bottom: 20px;">
            <div class="search-bar" style="width:100%"><i class="fa-solid fa-filter"></i><input type="text" id="filtro-manut-texto" placeholder="Pesquisar Placa, Categoria ou Motivo (Atuais e Histórico)..." onkeyup="renderizarTabelaManutencao()"></div>
        </div>
        
        <h3 style="color: var(--primary); font-weight: 800; margin-bottom: 15px;">Em Manutenção (Atuais: <span id="count-manutencao-ativa">0</span>)</h3>
        <div class="table-wrapper" style="margin-bottom: 30px;">
            <table id="tabela-manutencao-ativa">
                <thead><tr><th>Placa</th><th>Modelo</th><th>Categoria</th><th>Motivo</th><th>Data Início</th><th>Tempo</th><th>Ação</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <h3 style="color: var(--manutencao); font-weight: 800; border-top: 1px solid var(--border); padding-top: 20px;">Histórico de Manutenção</h3>
        <div class="table-wrapper">
            <table id="tabela-manutencao-historico">
                <thead><tr><th>Placa</th><th>Categoria</th><th>Motivo</th><th>Início</th><th>Fim</th><th>Tempo Total</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="aba-historico" class="tab-content">
        <div class="control-panel" style="grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; padding: 20px;">
            <div class="search-bar" style="width:100%"><i class="fa-solid fa-filter"></i><input type="text" id="filtro-hist-texto" placeholder="Filtrar..." onkeyup="filtrarHistorico()"></div>
            <input type="date" id="filtro-data-inicio" onchange="filtrarHistorico()">
            <input type="date" id="filtro-data-fim" onchange="filtrarHistorico()">
            <button class="btn-action" style="background: var(--success); padding: 10px 20px; font-size: 0.8rem;" onclick="exportarExcel()"><i class="fa-solid fa-file-csv"></i></button>
        </div>
        <div class="table-wrapper">
            <table id="tabela-historico">
                <thead><tr><th>Data</th><th>Placa</th><th>Condutor</th><th>KM Rodados</th><th>Obs</th><th class="admin-only">Ação</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div style="display: flex; justify-content: center; margin-top: 20px; gap: 20px;">
            <button class="tab-btn" style="width:50px; flex-grow:0" onclick="mudarPagina(-1)"><i class="fa-solid fa-chevron-left"></i></button>
            <span id="page-info" style="font-weight: 700; color: var(--text-sec);">Página 1</span>
            <button class="tab-btn" style="width:50px; flex-grow:0" onclick="mudarPagina(1)"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
    </div>

    <div id="aba-gestao" class="tab-content">
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px;">
            <div class="chart-card">
                <h3 style="color: var(--primary); margin-bottom: 20px;">Cadastro</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group"><input type="text" id="gestao-placa" placeholder="PLACA" style="text-transform: uppercase;"></div>
                    <div class="form-group"><input type="text" id="gestao-modelo" placeholder="MODELO"></div>
                    <div class="form-group"><input type="number" id="gestao-km-atual" placeholder="KM ATUAL"></div>
                    <div class="form-group"><input type="number" id="gestao-km-revisao" placeholder="KM REVISÃO"></div>
                </div>
                <div class="form-group" style="margin-top: 15px;"><input type="text" id="gestao-condutor" placeholder="CONDUTOR PADRÃO"></div>
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <button class="btn-action" style="background: var(--success); flex: 1;" onclick="salvarVeiculo()">SALVAR <i class="fa-solid fa-floppy-disk"></i></button>
                    <button class="btn-action" style="background: var(--manutencao); width: 100px;" onclick="limparFormGestao()">NOVO</button>
                </div>
                <div class="table-wrapper" style="margin-top: 30px;">
                    <table id="tabela-gestao">
                        <thead><tr><th>Placa</th><th>Modelo</th><th>KM</th><th>Rev.</th><th>Ação</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <div>
                <div class="chart-card" style="height: fit-content; margin-bottom: 25px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Backup</h3>
                    <button class="btn-action" style="background: var(--primary); width: 100%; margin-bottom: 15px;" onclick="baixarBackup()"><i class="fa-solid fa-download"></i> BAIXAR</button>
                    <button class="btn-action" style="background: var(--accent); width: 100%;" onclick="document.getElementById('input-restore').click()"><i class="fa-solid fa-upload"></i> RESTAURAR</button>
                </div>
                
                <div class="chart-card" style="height: fit-content;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;"><i class="fa-solid fa-list-check"></i> Categorias de Manutenção</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="text" id="input-nova-categoria" placeholder="Nova Categoria" style="flex: 1; padding: 10px; border-radius: 8px;">
                        <button class="btn-action" style="background: var(--accent); width: 80px; padding: 10px; border-radius: 10px;" onclick="adicionarCategoria()">ADD</button>
                    </div>
                    <ul id="lista-categorias" style="list-style: none; padding: 0; max-height: 150px; overflow-y: auto;">
                        </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script type="module">
   // Diagnóstico Máximo
alert("Passo 1: Script carregado");

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

alert("Passo 2: Bibliotecas importadas");

const firebaseConfig = {
    apiKey: "AIzaSyAR87299J4SWl8qz9zX9_cNjJMoiXfRdDc",
    authDomain: "aegea-21b34.firebaseapp.com",
    databaseURL: "https://aegea-21b34-default-rtdb.firebaseio.com",
    projectId: "aegea-21b34",
    storageBucket: "aegea-21b34.firebasestorage.app",
    messagingSenderId: "205645361536",
    appId: "1:205645361536:web:5223c969f8441b213c1165"
};

try {
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    alert("Passo 3: Firebase inicializado");

    set(ref(db, 'teste_celular'), { 
        status: "Funcionando", 
        data: new Date().toISOString() 
    }).then(() => {
        alert("FINAL: DADO GRAVADO NO FIREBASE!");
    }).catch(e => {
        alert("ERRO NO FIREBASE: " + e.message);
    });
} catch (err) {
    alert("ERRO CRÍTICO: " + err.message);
}
</script>
</body>
</html>
